{% extends "layout.html" %}

{% block title %}{{ recipe.title }}{% endblock %}

{% block content %}
<div class="header">
  <h3>{{ recipe.title }}</h3>
  {% if recipe.avg_rating %}
  <p>Arvosana: {{ recipe.avg_rating }} / 5</p>
  <p>{{ recipe.rating_count }} arvostelua</p>
  {% else %}
  <p>Ei arvosteluja</p>
  {% endif %}
  {% if session.username == recipe.username %}
  <form action="/edit/{{ recipe.id }}">
    <button type="submit">Muokkaa</button>
  </form>
  {% endif %}
</div>
<div class="item">
  <table>
    {% for i in ingredients %}
    <tr>
      <td>{{ i }}</td>
    </tr>
    {% endfor %}
  </table>
  <ol>
    {% for i in instructions %}
    <li>{{ i }}</li>
    {% endfor %}
  </ol>
  <br>
  <p><i>{{recipe.username}}</i></p>
  <p>{{ recipe.created_at | format_date }}</p>
  <br>
  <p>
    {% for tag in tags %}
    <a href="{{ url_for('search', query=tag.name) }}">#{{ tag }}</a>&nbsp;
    {% endfor %}
  </p>
</div>

<div class="header">
  <h3>Arvostelut</h3>
</div>
<div class="content">
  {% if session.username %}
  <div class="item">
    {% for message in get_flashed_messages() %}
    <p class="error">{{ message }}</p>
    {% endfor %}
    <form action="/create_review/{{ recipe.id }}" method="POST">
      <p>
        <label for="rating">Arvosana:</label>
        <input type="number" id="rating" name="rating" min="1" max="5" class="textbox">
        / 5
      </p>
      <br>
      <textarea name="comment" id="comment" class="textbox" rows="7" cols="70"></textarea>
      <br>
      <button type="submit" value="L채het채">L채het채</button>
    </form>
  </div>
  {% endif %}
  {% for r in reviews %}
  <div class="item">
    {% if r.rating %}
    <p>{{r .rating }} / 5</p>
    {% endif %}
    <p>{{ r.comment }}</p>
    <p>
      <a href="/user/{{ r.user_id }}">{{ r.username }}</a> {{ r.created_at | format_date }}
    </p>
  </div>
  {% endfor %}
</div>
{% endblock %}